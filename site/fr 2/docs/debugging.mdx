# Guide de Dépannage

**Résoudre les problèmes courants et les erreurs de configuration d'AKIOS**

Ce guide couvre les problèmes fréquemment rencontrés, leurs causes et les solutions étape par étape pour AKIOS V1.0.

## Diagnostic Rapide

Lancez la commande de diagnostic pour vérifier la santé du système :

```bash
# Vérifier l'état global du système
./akios status

# Activer la journalisation de débogage pour un dépannage détaillé
./akios --debug status

# Voir les événements d'audit récents
./akios audit view --limit 10

# Vérifier la validité de la configuration
./akios config validate
```

### Journalisation de Débogage

Pour un dépannage avancé, activez la journalisation de débogage pour voir les opérations internes détaillées :

```bash
# Activer le debug pour n'importe quelle commande
./akios --debug status
./akios --debug run workflow.yml

# Ou définir une variable d'environnement
export AKIOS_DEBUG=1
./akios status
```

Les journaux de débogage fournissent des informations détaillées sur :
- Le chargement et la validation de la configuration
- Les étapes d'exécution du workflow
- Les opérations des agents et les appels API
- Les contrôles de sécurité et la journalisation d'audit

## Problèmes d'Installation

### Dépannage de la Distribution Hybride

**AKIOS V1.0 supporte plusieurs méthodes d'installation - utilisez ce guide pour dépanner chacune :**

#### **Problèmes Binaire / Wrapper Docker**

**Symptômes :**
- `command not found`
- Erreurs de permission refusée

**Solutions :**
1. **Rendre exécutable :** `chmod +x akios-linux-x64` (ou le nom de votre binaire).
2. **Vérifier le PATH :** Assurez-vous que le binaire est dans votre répertoire actuel ou dans votre PATH système.

#### **Problèmes Paquet Pip**

**Symptômes :**
- Erreurs d'importation après pip install
- Fonctionnalités de sécurité inactives sur les plateformes non-Linux

**Solutions :**
1. **Vérifier l'installation pip :** `pip show akios`
2. **Vérifier la version Python :** Doit être 3.8+
3. **Réinstaller :** `pip uninstall akios && pip install akios`

#### **Problèmes Docker**

**Symptômes :**
- `docker: command not found`
- Le conteneur quitte immédiatement
- Problèmes de permissions de montage de volume

**Solutions :**
1. **Vérifier Docker :** `docker run hello-world`
2. **Vérifier les Permissions :** Assurez-vous que votre utilisateur est dans le groupe `docker` (Linux) ou que Docker Desktop est lancé (Mac/Win).
3. **Forcer le Pull :** `AKIOS_FORCE_PULL=1 ./akios status` si l'image semble obsolète.

## Problèmes de Configuration

### Problèmes de Variables d'Environnement

**Symptômes :**
- Erreurs "API key not found"
- La configuration ne se charge pas

**Solutions :**
1. **Vérifier le fichier .env :** Assurez-vous qu'il existe et contient des paires `CLE=valeur` valides.
2. **Corriger les Corruptions :** Cherchez des valeurs concaténées comme `grokopenai` et corrigez-les manuellement.
3. **Utiliser l'Assistant :** Lancez `./akios setup --force` pour régénérer la configuration.

### Erreurs de Fournisseur LLM

**Symptômes :**
- "Model 'xyz' is not valid for provider 'abc'"
- "Unknown LLM provider"

**Solutions :**
1. **Vérifier les Combinaisons :** Assurez-vous d'utiliser des paires fournisseur/modèle compatibles (ex: Fournisseur `openai` avec Modèle `gpt-4`).
2. **Insensible à la Casse :** `gpt-4`, `GPT-4`, et `Gpt-4` sont tous valides.

## Problèmes d'Exécution de Workflow

### Échecs d'Exécution d'Agent

#### Agent Système de Fichiers (Filesystem)
- **Erreur :** "Path not allowed"
- **Correctif :** Ajoutez le chemin à `allowed_paths` dans `config.yaml`. Utilisez des chemins absolus dans les workflows.

#### Agent LLM
- **Erreur :** "Rate limit exceeded" ou "API key missing"
- **Correctif :** Vérifiez votre quota API et vérifiez les variables `AKIOS_LLM_PROVIDER` et `_API_KEY`.

#### Agent HTTP
- **Erreur :** Connexion refusée ou délai dépassé
- **Correctif :** Assurez-vous que `network_access_allowed: true` est dans `config.yaml`.

## Problèmes Spécifiques à Docker

### Workflow Bloqué sur Opérations de Fichiers
**Symptômes :** Les workflows se bloquent sur la lecture/écriture de fichiers, surtout sur macOS/Windows.
**Cause :** Les limites de ressources POSIX entrent en conflit avec la gestion cgroup de Docker dans les environnements virtualisés.
**Solution :**
1. **Mettre à jour Docker Desktop :** Utilisez la dernière version.
2. **Désactiver le Sandboxing (Si nécessaire) :** Définissez `sandbox_enabled: false` dans `config.yaml` pour utiliser l'isolation native de Docker au lieu des limites POSIX supplémentaires.

### Échecs de Récupération d'Image
**Solution :** Lancez `docker pull akiosai/akios:v1.0.0` manuellement ou vérifiez votre connexion réseau.

## Problèmes de Sécurité

### Échecs de Sécurité au Démarrage
**Symptômes :** "SECURITY VALIDATION FAILED"
**Cause :** Support seccomp manquant ou noyau trop vieux (sur Linux Natif).
**Solution :** Assurez-vous d'exécuter sur Linux avec Noyau 5.4+. Pour macOS/Windows, utilisez la méthode Docker qui gère cela pour vous.

### Problèmes de Rédaction PII
**Symptômes :** Données sensibles apparaissant dans les journaux.
**Solution :** Assurez-vous que `pii_redaction_enabled: true` est dans `config.yaml` et `audit_enabled: true`.

## Récupération d'Urgence

Pour les problèmes critiques où le système ne répond plus :

1. **Arrêter tous les workflows :** `pkill -f akios`
2. **Sauvegarder les données :** `cp -r data/ data.backup`
3. **Réinitialiser la configuration :** `./akios setup --force`
4. **Nettoyer les caches :** `./akios clean all`
