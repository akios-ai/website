# AKIOS V1.0 ‚Äì R√©f√©rence de Configuration

**Guide de configuration complet pour la cage de s√©curit√© AKIOS.**

AKIOS utilise un fichier unique `config.yaml` pour tous les param√®tres. La configuration est charg√©e au d√©marrage et ne peut pas √™tre modifi√©e pendant l'ex√©cution pour des raisons de s√©curit√©. Tous les param√®tres ont des valeurs par d√©faut ax√©es sur la s√©curit√©.

## üìÅ Emplacement du Fichier de Configuration

AKIOS recherche `config.yaml` dans le r√©pertoire de travail actuel :

```
project/
‚îú‚îÄ‚îÄ config.yaml          # Fichier de configuration principal
‚îú‚îÄ‚îÄ workflows/           # D√©finitions des workflows
‚îú‚îÄ‚îÄ templates/           # Mod√®les de workflow
‚îú‚îÄ‚îÄ data/               # Donn√©es d'entr√©e/sortie
‚îî‚îÄ‚îÄ audit/              # Journaux d'audit
```

## Configuration Initiale et Gestion

AKIOS inclut un assistant de configuration interactif qui rend la configuration initiale simple.

### Assistant de Configuration Interactif

L'assistant vous guide √† travers :
- S√©lection du fournisseur (OpenAI, Anthropic, Grok, Mistral, ou Gemini)
- Configuration de la cl√© API avec validation du format
- G√©n√©ration et validation de la configuration

```bash
# L'assistant se lance automatiquement √† la premi√®re commande
akios run templates/hello-workflow.yml

# Ou lancez-le manuellement
akios setup

# Forcez la r√©ex√©cution si n√©cessaire
akios setup --force
```

### Variables d'Environnement (fichier `.env`)

AKIOS utilise des variables d'environnement pour la configuration sensible :

```bash
# Cl√©s API (choisissez votre fournisseur)
AKIOS_LLM_PROVIDER=grok
GROK_API_KEY=xai-votre-cle-ici
AKIOS_LLM_MODEL=grok-3

# Param√®tres de Mode
AKIOS_MOCK_LLM=0              # 0=appels LLM r√©els, 1=sortie LLM simul√©e
AKIOS_NETWORK_ACCESS_ALLOWED=1 # Autoriser les appels API externes

# Contr√¥les du Wrapper Docker
AKIOS_FORCE_PULL=1            # Toujours r√©cup√©rer la derni√®re image avant l'ex√©cution

# Optionnel : Cl√©s sp√©cifiques au fournisseur
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GROK_API_KEY=xai-...
MISTRAL_API_KEY=votre-cle-mistral...
GEMINI_API_KEY=votre-cle-gemini...
```

### Indicateur de Mode API R√©el

Pour plus de commodit√©, vous pouvez activer le mode API r√©el directement depuis la ligne de commande :

```bash
# Activer le mode API r√©el avec configuration interactive
akios run workflow.yml --real-api

# Cela effectue automatiquement :
# - D√©finit AKIOS_MOCK_LLM=0
# - Active l'acc√®s r√©seau
# - Demande les cl√©s API manquantes de mani√®re interactive
# - Valide la configuration
```

**L'indicateur `--real-api` offre une transition transparente des tests simul√©s vers l'utilisation r√©elle de l'API sans modification manuelle de la configuration.**

### D√©tection de Corruption de Configuration

AKIOS d√©tecte automatiquement et aide √† corriger la corruption courante du fichier `.env` :

- **Noms de fournisseurs concat√©n√©s** : `grokopenai` ‚Üí sugg√®re `grok`
- **Formats de cl√©s API invalides** : Validation en temps r√©el avec v√©rifications sp√©cifiques au fournisseur
- **Bool√©ens mal form√©s** : `tru` ‚Üí sugg√®re `true`
- **Champs requis manquants** : Conseils clairs sur ce qui est n√©cessaire

**Exemple d'erreur avec suggestion de correction :**
```
CONFIGURATION VALIDATION FAILED: .env corruption detected
Line 3: AKIOS_LLM_PROVIDER=grokopenai
Suggestion: Concatenated provider names: 'grok' + 'openai' = 'grokopenai'
Fix: Change to AKIOS_LLM_PROVIDER=grok
```

### Priorit√© de Chargement de la Configuration

1. **Variables d'Environnement** (priorit√© la plus haute - √©crase tout)
2. **Fichier `.env`** (charg√© automatiquement si pr√©sent)
3. **`config.yaml`** (fichier de configuration de base)
4. **Valeurs par d√©faut int√©gr√©es** (replis s√©curis√©s)

## ‚öôÔ∏è Structure de la Configuration

```yaml
# Essentiels de la cage de s√©curit√©
sandbox_enabled: true
cpu_limit: 0.8
memory_limit_mb: 256
max_open_files: 100
max_file_size_mb: 10
network_access_allowed: false

# PII & conformit√©
pii_redaction_enabled: true
redaction_strategy: "mask"

# Protection contre les co√ªts et boucles
cost_kill_enabled: true
max_tokens_per_call: 500
budget_limit_per_run: 1.0

# Audit & chemins
audit_enabled: true
audit_storage_path: "./audit/"
audit_export_format: "json"

# G√©n√©ral
environment: "development"
log_level: "INFO"
```

## üîí Param√®tres de la Cage de S√©curit√©

### `sandbox_enabled`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Active le sandboxing de s√©curit√© (niveau noyau sur Linux natif avec seccomp-bpf, bas√© sur des politiques dans Docker)

Lorsque activ√© :
- Les processus s'ex√©cutent dans des espaces de noms noyau isol√©s
- Les appels syst√®me dangereux sont bloqu√©s
- L'acc√®s au syst√®me de fichiers est restreint
- L'acc√®s r√©seau est contr√¥l√©

**Impact S√©curit√© :** Critique - fournit la garantie d'isolation principale

```yaml
sandbox_enabled: true  # Recommand√© : toujours true
```

### `cpu_limit`
**Type :** `float` (0.1 - 1.0)  
**D√©faut :** `0.8`  
**Description :** Limite d'utilisation CPU en fraction du total des c≈ìurs CPU

Limite les ressources CPU disponibles pour l'ensemble du workflow. Emp√™che les processus incontr√¥l√©s de consommer tout le CPU syst√®me.

```yaml
cpu_limit: 0.8  # Utiliser 80% des c≈ìurs CPU disponibles
```

### `memory_limit_mb`
**Type :** `integer` (> 0)  
**D√©faut :** `256`  
**Description :** Limite de m√©moire en m√©gaoctets pour l'ensemble du workflow

Termine automatiquement les workflows qui d√©passent les limites de m√©moire. Emp√™che les attaques par √©puisement de la m√©moire.

```yaml
memory_limit_mb: 256  # Limite de 256Mo par workflow
```

### `max_open_files`
**Type :** `integer` (> 10)  
**D√©faut :** `100`  
**Description :** Nombre maximum de descripteurs de fichiers ouverts

Emp√™che les attaques par √©puisement des descripteurs de fichiers et limite les op√©rations de fichiers concurrentes.

```yaml
max_open_files: 100  # Maximum 100 fichiers ouverts
```

### `max_file_size_mb`
**Type :** `integer` (> 0)  
**D√©faut :** `10`  
**Description :** Taille maximale de fichier en m√©gaoctets pour les op√©rations d'√©criture

Limite la taille des fichiers qui peuvent √™tre √©crits pour emp√™cher l'√©puisement de l'espace disque.

```yaml
max_file_size_mb: 10  # Taille max de fichier 10Mo
```

### `network_access_allowed`
**Type :** `boolean`  
**D√©faut :** `false`  
**Description :** Autoriser l'acc√®s r√©seau pour les op√©rations de l'agent HTTP

Lorsque d√©sactiv√©, les requ√™tes de l'agent HTTP sont bloqu√©es. Lorsque activ√©, l'acc√®s r√©seau limit√© en d√©bit est autoris√©.

```yaml
network_access_allowed: false  # Bloquer tout acc√®s r√©seau (s√©curis√©)
network_access_allowed: true   # Autoriser les appels r√©seau de l'agent HTTP
```

## üõ°Ô∏è Param√®tres PII & Conformit√©

### `pii_redaction_enabled`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Activer la r√©daction PII en temps r√©el sur les entr√©es de l'agent

D√©tecte et r√©dige automatiquement les donn√©es sensibles dans les invites et les messages :
- Adresses email
- Num√©ros de t√©l√©phone
- Num√©ros de s√©curit√© sociale
- Num√©ros de carte de cr√©dit
- Adresses IP
- Cl√©s API et mots de passe

```yaml
pii_redaction_enabled: true  # Recommand√© : toujours true
```

### `redaction_strategy`
**Type :** `string` ("mask" | "hash" | "remove")  
**D√©faut :** `"mask"`  
**Description :** Comment g√©rer les donn√©es PII d√©tect√©es

- `"mask"` : Remplacer par le marqueur `[REDACTED]`
- `"hash"` : Remplacer par le hachage SHA-256
- `"remove"` : Supprimer compl√®tement les donn√©es

```yaml
redaction_strategy: "mask"  # S√ªr, pr√©serve la structure des donn√©es
```

### `pii_redaction_outputs`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Activer la r√©daction PII sur les sorties LLM

Applique un filtrage PII suppl√©mentaire aux r√©ponses g√©n√©r√©es par l'IA pour √©viter les fuites de donn√©es accidentelles. Utilise des mod√®les conservateurs adapt√©s au contenu g√©n√©r√©.

**Impact S√©curit√© :** Emp√™che l'exposition de PII dans les r√©ponses IA  
**Impact Performance :** Minime (<1ms par r√©ponse)

```yaml
pii_redaction_outputs: true  # Recommand√© : toujours true pour la s√©curit√©
```

### `pii_redaction_aggressive`
**Type :** `boolean`  
**D√©faut :** `false`  
**Description :** Utiliser des r√®gles de r√©daction PII agressives

Lorsque activ√©, applique des mod√®les plus stricts incluant :
- D√©tection d'adresse g√©n√©rique
- Formats de num√©ro de t√©l√©phone √©tendus
- Correspondance de mod√®les sensibles suppl√©mentaires

**Cas d'Usage :** Environnements haute s√©curit√© n√©cessitant une protection maximale  
**Compromis :** Peut avoir des faux positifs sur du contenu l√©gitime

```yaml
pii_redaction_aggressive: false  # Utiliser uniquement si une s√©curit√© maximale est requise
```

## üí∞ Protection Co√ªts & Ressources

### `cost_kill_enabled`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Activer la terminaison automatique lorsque les limites de budget sont d√©pass√©es

Fournit une protection financi√®re contre les co√ªts IA incontr√¥l√©s et les boucles infinies.

```yaml
cost_kill_enabled: true  # Recommand√© : toujours true
```

### `max_tokens_per_call`
**Type :** `integer` (> 0)  
**D√©faut :** `500`  
**Description :** Maximum de tokens par appel API LLM

Limite les requ√™tes LLM individuelles pour √©viter des co√ªts API excessifs.

```yaml
max_tokens_per_call: 500  # Limite conservatrice
max_tokens_per_call: 1000 # Limite plus √©lev√©e pour t√¢ches complexes
```

### `budget_limit_per_run`
**Type :** `float` (> 0.0)  
**D√©faut :** `1.0`  
**Description :** Budget maximum en USD par ex√©cution de workflow

Termine automatiquement les workflows qui d√©passent les limites de co√ªt.

```yaml
budget_limit_per_run: 1.0   # $1.00 par workflow (recommand√©)
budget_limit_per_run: 5.0   # $5.00 pour workflows complexes
```

## üõ°Ô∏è Param√®tres de Validation d'Entr√©e & Fiabilit√©

### `input_validation_enabled`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Activer la validation automatique des entr√©es et les limites de taille

Valide toutes les entr√©es IA pour la s√©curit√© et emp√™che les requ√™tes surdimensionn√©es.

```yaml
input_validation_enabled: true  # Recommand√© : toujours true
```

### `max_input_chars`
**Type :** `integer` (> 0)  
**D√©faut :** `100000`  
**Description :** Caract√®res maximum autoris√©s dans les entr√©es IA

Rejette automatiquement les entr√©es d√©passant cette limite pour pr√©venir les attaques DoS.

```yaml
max_input_chars: 100000  # 100k caract√®res (recommand√©)
max_input_chars: 50000   # Limite plus petite pour environnements restreints
```

## üìä Param√®tres d'Audit & Journalisation

### `audit_enabled`
**Type :** `boolean`  
**D√©faut :** `true`  
**Description :** Activer la journalisation d'audit compl√®te

Enregistre chaque action de l'agent avec une preuve d'int√©grit√© cryptographique.

```yaml
audit_enabled: true  # Recommand√© : toujours true
```

### `audit_storage_path`
**Type :** `string`  
**D√©faut :** `"./audit/"`  
**Description :** Chemin du r√©pertoire pour stocker les journaux d'audit

Les journaux d'audit sont stock√©s sous forme de fichiers JSON Lines infalsifiables.

```yaml
audit_storage_path: "./audit/"  # R√©pertoire d'audit par d√©faut
audit_storage_path: "/var/log/akios/"  # Chemin personnalis√©
```

### `audit_export_format`
**Type :** `string` ("json")
**D√©faut :** `"json"`
**Description :** Format d'exportation pour les rapports d'audit

- `"json"` : Format JSON lisible par machine avec v√©rification d'int√©grit√© cryptographique

```yaml
audit_export_format: "json"   # Format JSON avec v√©rification d'int√©grit√©
```

## ‚öôÔ∏è Param√®tres G√©n√©raux

### `environment`
**Type :** `string` ("development" | "testing" | "production")  
**D√©faut :** `"development"`  
**Description :** Identifiant de l'environnement d'ex√©cution

Affecte la verbosit√© de la journalisation et la rigueur de la s√©curit√©.

```yaml
environment: "development"  # Journalisation plus verbeuse
environment: "production"   # S√©curit√© plus stricte, moins de journaux
```

### `log_level`
**Type :** `string` ("DEBUG" | "INFO" | "WARNING" | "ERROR")  
**D√©faut :** `"INFO"`  
**Description :** Niveau de verbosit√© de la journalisation

Contr√¥le le niveau de d√©tail de la journalisation console et fichier.

```yaml
log_level: "DEBUG"    # Verbosit√© maximale (d√©veloppement)
log_level: "INFO"     # Verbosit√© standard (recommand√©)
log_level: "WARNING"  # Uniquement avertissements et erreurs
```

## üîß Variables d'Environnement

AKIOS supporte la configuration par variables d'environnement avec le pr√©fixe `AKIOS_` :

```bash
# √âcraser les valeurs de config
export AKIOS_CPU_LIMIT=0.5
export AKIOS_MEMORY_LIMIT_MB=128
export AKIOS_BUDGET_LIMIT_PER_RUN=0.5
export AKIOS_LOG_LEVEL=DEBUG
```

## üìã Exemple de Configuration Compl√®te

```yaml
# Configuration de Production AKIOS V1.0
# Param√®tres maximisant la s√©curit√© pour les charges de travail de production

# Cage de s√©curit√© - protection maximale
sandbox_enabled: true
cpu_limit: 0.5
memory_limit_mb: 128
max_open_files: 50
max_file_size_mb: 5
network_access_allowed: false

# Protection PII - toujours activ√©e
pii_redaction_enabled: true
redaction_strategy: "mask"

# Contr√¥le des co√ªts - limites strictes
cost_kill_enabled: true
max_tokens_per_call: 250
budget_limit_per_run: 0.5

# Audit - complet
audit_enabled: true
audit_storage_path: "./audit/"
audit_export_format: "json"

# Environnement
environment: "production"
log_level: "WARNING"
```

## ‚ö†Ô∏è Notes de S√©curit√© de Configuration

- **La configuration est en lecture seule** apr√®s le d√©marrage d'AKIOS
- **Pas de modification de configuration √† l'ex√©cution** pour la s√©curit√©
- **Validez les fichiers de config** avant d√©ploiement
- **Utilisez des permissions restrictives** sur les fichiers de config (`600`)
- **Ne commitez jamais de secrets** dans le contr√¥le de version

## üîç Validation de Configuration

AKIOS valide la configuration au d√©marrage :

```bash
# Tester la configuration sans lancer de workflows
akios --help  # Valide la config pendant l'initialisation

# V√©rifier les erreurs de configuration
akios status  # Affiche l'√©tat actuel de la configuration
```

Les configurations invalides √©choueront imm√©diatement avec des messages d'erreur clairs.

## üöÄ Configurations de D√©marrage Rapide

### D√©veloppement (Relax√©)
```yaml
sandbox_enabled: true
cpu_limit: 0.8
memory_limit_mb: 512
network_access_allowed: true
budget_limit_per_run: 5.0
log_level: "DEBUG"
```

### Production (S√©curis√©)
```yaml
sandbox_enabled: true
cpu_limit: 0.5
memory_limit_mb: 128
network_access_allowed: false
budget_limit_per_run: 1.0
log_level: "WARNING"
```

### Test (Minimal)
```yaml
sandbox_enabled: false  # D√©sactiver pour tests plus rapides
cpu_limit: 0.9
memory_limit_mb: 1024
network_access_allowed: true
budget_limit_per_run: 10.0
log_level: "DEBUG"
```

**Rappel :** La configuration ne peut pas √™tre modifi√©e pendant l'ex√©cution du workflow. Planifiez vos param√®tres soigneusement pour le profil de s√©curit√© et de performance dont vous avez besoin.

## üõ†Ô∏è Impact de la M√©thode d'Installation sur la Configuration

La fa√ßon dont vous installez AKIOS affecte les fonctionnalit√©s de s√©curit√© disponibles et les configurations par d√©faut :

### D√©ploiement Paquet Pip
**Plateformes :** Linux uniquement (recommand√©)
**Niveau de S√©curit√© :** S√©curit√© compl√®te au niveau noyau
**Notes de Configuration :**
- Fonctionnalit√©s de s√©curit√© maximales disponibles
- Sandboxing niveau noyau (seccomp-bpf, cgroups)
- Permissions natives du syst√®me de fichiers
- Meilleures performances et s√©curit√©

### D√©ploiement Docker
**Plateformes :** Linux, macOS, Windows
**Niveau de S√©curit√© :** S√©curit√© forte bas√©e sur des politiques
**Notes de Configuration :**
- Comportement coh√©rent sur toutes les plateformes
- Isolation par conteneur au lieu de sandboxing noyau
- Contr√¥les r√©seau via politiques de conteneur
- Limites m√©moire et CPU via Docker

### Choisir la Bonne Installation

| Cas d'Usage | M√©thode Recommand√©e | Pourquoi |
|-------------|---------------------|----------|
| **S√©curit√© maximale, production Linux** | Paquet Pip | Fonctionnalit√©s de s√©curit√© noyau |
| **√âquipe de d√©veloppement multi-plateforme** | Docker | Environnement coh√©rent partout |
| **Int√©gration √©cosyst√®me Python** | Paquet Pip | Compatibilit√© Python compl√®te |

### Configuration Sp√©cifique √† la Plateforme

#### Linux (Toutes M√©thodes)
```yaml
# S√©curit√© maximale disponible
sandbox_enabled: true  # seccomp-bpf + cgroups
environment: "production"
```

#### macOS/Windows (Docker)
```yaml
# S√©curit√© forte bas√©e sur des politiques
sandbox_enabled: true  # Politiques conteneur + liste blanche
environment: "production"
# Note : Pas de seccomp-bpf niveau noyau disponible
```

#### Docker (Toutes Plateformes)
```yaml
# Param√®tres conscients du conteneur
sandbox_enabled: true
network_access_allowed: true  # Pour agent HTTP
# Docker g√®re l'isolation des ressources
```

### Validation de Configuration par M√©thode

AKIOS valide la compatibilit√© de la configuration avec votre m√©thode de d√©ploiement :

```bash
# Paquet Pip - valide les fonctionnalit√©s du noyau Linux
akios status  # Affiche l'√©tat de s√©curit√© noyau

# Docker - valide l'environnement conteneur
akios status  # Affiche l'√©tat de s√©curit√© bas√© sur les politiques
```

**Astuce :** Lancez `akios status` apr√®s l'installation pour voir vos capacit√©s de s√©curit√© et l'√©tat de la configuration.
